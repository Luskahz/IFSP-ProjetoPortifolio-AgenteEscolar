generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model alunos { 
  id         Int          @id @default(autoincrement())
  nome       String       @db.VarChar(100)
  email      String?      @unique(map: "email") @db.VarChar(150)
  created_at DateTime?    @default(now()) @db.Timestamp(0)
  updated_at DateTime?    @default(now()) @db.Timestamp(0)
  matriculas matriculas[]
  notas      notas[]
}

model cursos {
  id          Int           @id @default(autoincrement())
  nome        String        @db.VarChar(100)
  descricao   String?       @db.Text
  created_at  DateTime?     @default(now()) @db.Timestamp(0)
  updated_at  DateTime?     @default(now()) @db.Timestamp(0)
  disciplinas disciplinas[]
  periodos    periodos[]
}

model disciplinas {
  id         Int       @id @default(autoincrement())
  nome       String    @db.VarChar(100)
  curso_id   Int
  created_at DateTime? @default(now()) @db.Timestamp(0)
  updated_at DateTime? @default(now()) @db.Timestamp(0)
  cursos     cursos    @relation(fields: [curso_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "disciplinas_ibfk_1")
  notas      notas[]
  turmas     turmas[]

  @@index([curso_id], map: "curso_id")
}

model matriculas {
  id         Int       @id @default(autoincrement())
  aluno_id   Int
  periodo_id Int
  created_at DateTime? @default(now()) @db.Timestamp(0)
  updated_at DateTime? @default(now()) @db.Timestamp(0)
  alunos     alunos    @relation(fields: [aluno_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "matriculas_ibfk_1")
  periodos   periodos  @relation(fields: [periodo_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "matriculas_ibfk_2")

  @@index([aluno_id], map: "aluno_id")
  @@index([periodo_id], map: "periodo_id")
}

model notas {
  id            Int         @id @default(autoincrement())
  aluno_id      Int
  disciplina_id Int
  periodo_id    Int
  tipo_nota_id  Int
  valor         Decimal     @db.Decimal(5, 2)
  created_at    DateTime?   @default(now()) @db.Timestamp(0)
  updated_at    DateTime?   @default(now()) @db.Timestamp(0)
  tipos_nota    tipos_nota  @relation(fields: [tipo_nota_id], references: [id], onUpdate: NoAction, map: "fk_notas_tiposnota")
  alunos        alunos      @relation(fields: [aluno_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "notas_ibfk_1")
  disciplinas   disciplinas @relation(fields: [disciplina_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "notas_ibfk_2")
  periodos      periodos    @relation(fields: [periodo_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "notas_ibfk_3")

  @@unique([aluno_id, disciplina_id, periodo_id, tipo_nota_id], map: "unica_nota")
  @@index([disciplina_id], map: "disciplina_id")
  @@index([tipo_nota_id], map: "idx_tipo_nota")
  @@index([periodo_id], map: "periodo_id")
}

model periodos { //REPENSAR A EXISTENCIA DO PERIODO AO MESMO TEMPO DA EXISTENCIA DE APENAS UM CURSO POR PERIODO
  id         Int          @id @default(autoincrement())
  ano        Int          @db.Year
  curso_id   Int
  created_at DateTime?    @default(now()) @db.Timestamp(0)
  updated_at DateTime?    @default(now()) @db.Timestamp(0)
  matriculas matriculas[]
  notas      notas[]
  cursos     cursos       @relation(fields: [curso_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "periodos_ibfk_1")
  turmas     turmas[]

  @@index([curso_id], map: "curso_id")
}

model professores { //REPENSAR O RELACIONAMENTO, PARA QUE SE RELACIONE COM A DISCIPLINA
  id         Int       @id @default(autoincrement())
  nome       String    @db.VarChar(100)
  email      String?   @unique(map: "email") @db.VarChar(150)
  created_at DateTime? @default(now()) @db.Timestamp(0)
  updated_at DateTime? @default(now()) @db.Timestamp(0)
  turmas     turmas[]
}

model tipos_nota { //RETIRAR, DEIXAR APENAS NOTA
  id         Int       @id @default(autoincrement())
  turma_id   Int
  nome       String    @db.VarChar(30)
  peso       Decimal?  @default(1.00) @db.Decimal(3, 2)
  created_at DateTime? @default(now()) @db.Timestamp(0)
  updated_at DateTime? @default(now()) @db.Timestamp(0)
  notas      notas[]
  turmas     turmas    @relation(fields: [turma_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_tiposnota_turma")

  @@unique([turma_id, nome], map: "uk_turmanome")
  @@index([turma_id], map: "idx_turma")
}

model turmas { // PENSAR EM ALGUM IDENTIFICADOR TEXTUAL
  id            Int          @id @default(autoincrement())
  professor_id  Int
  disciplina_id Int
  periodo_id    Int
  created_at    DateTime?    @default(now()) @db.Timestamp(0)
  updated_at    DateTime?    @default(now()) @db.Timestamp(0)
  tipos_nota    tipos_nota[]
  professores   professores  @relation(fields: [professor_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "turmas_ibfk_1")
  disciplinas   disciplinas  @relation(fields: [disciplina_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "turmas_ibfk_2")
  periodos      periodos     @relation(fields: [periodo_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "turmas_ibfk_3")

  @@index([disciplina_id], map: "disciplina_id")
  @@index([periodo_id], map: "periodo_id")
  @@index([professor_id], map: "professor_id")
}
